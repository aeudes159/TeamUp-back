## Database Migrations

Schema files are stored in supabase/schemas/ for readability. Migrations are auto-generated from database changes.

For official doc: https://supabase.com/docs/guides/local-development/declarative-database-schemas#schema-migrations

Verify that your supabase instance is up and running.

### Creating or Modifying a Table

1. **Write your schema** in supabase/schemas/<table_name>.sql:

sql
-- supabase/schemas/my_table.sql
create table public.my_table (
id uuid references auth.users on delete cascade not null primary key,
name text not null,
created_at timestamp with time zone default now()
);

-- Enable RLS (always do this!)
alter table public.my_table enable row level security;

-- RLS Policies
create policy "Users can view their own data" on public.my_table
for select using ((select auth.uid()) = id);



2. **Generate the migration** automatically from the diff:

bash
supabase db diff -f <migration_name>



This creates a migration file in supabase/migrations/ with all the changes detected.

### Applying Migrations

Reset your local database and apply all migrations + seed:

bash
supabase migration up



### Checking Migration Status

bash
supabase migration list



## Seed Data

### Creating/Updating Seed Data

The seed file (supabase/seed.sql) contains initial data for local development.

To update the seed file with your current local database data:

bash
pnpm db-seed



This dumps all data from your local database into supabase/seed.sql.

### When to Update Seeds

Update seeds when you:
Add test users or profiles for development
Create reference data (categories, types, etc.)
Set up specific test scenarios

### Resetting Database with Seeds

To reset your local database and apply all migrations + seed data:

bash
pnpm db-reset



This runs supabase db reset which:
1. Drops the local database
2. Applies all migrations in order
3. Runs supabase/seed.sql

### Manual Seeding

You can also run the seed file manually:

bash
supabase db seed --local



## Security

If not said otherwise, always use row level security.
For a deeper security review, it is possible to impersonate users in the Supabase UI to see all data accessible.